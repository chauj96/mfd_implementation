clear; clc; close all;

% === path setup ===
thisFile = mfilename('fullpath');
unitTestDir = fileparts(thisFile);        % .../src/2D_toy/unitTest
toyDir = fileparts(unitTestDir);     % .../src/2D_toy

addpath(toyDir);                          
addpath(fullfile(toyDir, 'PolyMesher'));  

rehash;
%% --------------------------------------------
% case options: 'structured' or 'unstructured'
case_type = 'structured';

dt = 1;
nx = 1;
nz = 3;
Lx = 1.0;
Lz = 1.0;
rho = 1000;
gvec = [0; -9.81];
pD = 1.23e5;
tol = 1e-10;
g_c = 0.0 * (1.0e-6);

if strcmp(case_type, 'structured')
    [cell_struct, face_struct, vertices, cells] = buildStructureGrid(nx, nz, Lx, Lz);

elseif strcmp(case_type, 'unstructured')
    domain = @MbbDomain;
    n_cells = nz * nx;
    [cell_struct, face_struct, vertices, cells] = buildPolyGrid(domain, n_cells);
end

% Initialize physical properties
[cell_struct, face_struct] = initPhysicalParams(cell_struct, face_struct, Lx, Lz, case_type);

ip_type = 'tpfa';
locals = buildHydroLocals(cell_struct, face_struct, ip_type);
fprintf('TPFA%');
testHydro(cell_struct, face_struct, locals, rho, gvec, pD, tol);

ip_type = 'simple';
locals = buildHydroLocals(cell_struct, face_struct, ip_type);
testHydro(cell_struct, face_struct, locals, rho, gvec, pD, tol);

ip_type = 'general_parametric';
locals = buildHydroLocals(cell_struct, face_struct, ip_type);
testHydro(cell_struct, face_struct, locals, rho, gvec, pD, tol);